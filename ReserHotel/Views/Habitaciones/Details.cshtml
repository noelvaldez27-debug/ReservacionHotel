@using HotelSystem.Domain.Entities
@using System.Globalization
@model Habitacion
@{
 ViewData["Title"] = "Detalles Habitación";
 var gallery = (IReadOnlyList<string>)ViewBag.Gallery ?? new List<string>();
 var cover = gallery.FirstOrDefault() ?? "/img/placeholder.png";
 dynamic b = ViewBag.Boleta;
 bool hasData = b != null;
 bool hasReserva = hasData && b.HasReserva == true;
 var usd = CultureInfo.GetCultureInfo("en-US");
}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css" />
<div class="container mt-4">
 <h2>Habitación @Model.Numero</h2>
 <div class="row g-4">
 <div class="col-lg-6">
 <a href="@cover" class="glightbox" data-gallery="hab"><img src="@cover" class="img-fluid rounded mb-3" alt="@Model.Tipo" /></a>
 <div class="d-flex gap-2 flex-wrap">
 @foreach (var img in gallery) { <a href="@img" class="glightbox" data-gallery="hab"><img src="@img" style="width:100px;height:80px;object-fit:cover" class="rounded border" /></a> }
 </div>
 </div>
 <div class="col-lg-6">
 <dl class="row mb-0">
 <dt class="col-sm-4">Número</dt><dd class="col-sm-8">@Model.Numero</dd>
 <dt class="col-sm-4">Piso</dt><dd class="col-sm-8">@Model.Piso</dd>
 <dt class="col-sm-4">Tipo</dt><dd class="col-sm-8">@Model.Tipo</dd>
 <dt class="col-sm-4">Capacidad</dt><dd class="col-sm-8">@Model.Capacidad</dd>
 <dt class="col-sm-4">Amenidades</dt><dd class="col-sm-8">@Model.Amenidades</dd>
 </dl>
 </div>
 </div>
 <hr />
 <h5>@(hasReserva ? "Boleta de la última reserva" : "Boleta de referencia")</h5>
 @if (!hasData)
 {
 <div class="alert alert-info">No hay datos de reserva ni referencia para esta habitación.</div>
 }
 else
 {
 <div class="row g-4">
 <div class="col-md-7">
 <div class="border rounded p-3">
 <div class="row mb-2">
 <div class="col-sm-6"><strong>Huésped:</strong> @b.Huesped</div>
 <div class="col-sm-6"><strong>DNI:</strong> @b.Documento</div>
 </div>
 <div class="row mb-2">
 <div class="col-sm-4"><strong>Entrada:</strong> @b.Entrada</div>
 <div class="col-sm-4"><strong>Salida:</strong> @b.Salida</div>
 <div class="col-sm-4"><strong>Días:</strong> @(b.Noches != null ? ((IEnumerable<dynamic>)b.Noches).Count() :0)</div>
 </div>
 <h6 class="mt-3">Detalle noches</h6>
 @if (b.Noches != null && ((IEnumerable<dynamic>)b.Noches).Any())
 {
 <table class="table table-sm table-bordered mb-3">
 <thead class="table-light"><tr><th>Fecha</th><th class="text-end">Precio</th></tr></thead>
 <tbody>
 @foreach(var n in b.Noches){ <tr><td>@n.Fecha</td><td class="text-end">@string.Format(usd, "{0:C}", Convert.ToDecimal(n.Precio))</td></tr> }
 </tbody>
 </table>
 }
 else { <p class="text-muted mb-3">Sin noches registradas.</p> }
 <h6>Servicios</h6>
 @if (b.Servicios != null && ((IEnumerable<dynamic>)b.Servicios).Any())
 {
 <table class="table table-sm table-bordered mb-0">
 <thead class="table-light"><tr><th>Servicio</th><th class="text-center">Cant.</th><th class="text-end">P.Unit</th><th class="text-end">Subtotal</th></tr></thead>
 <tbody>
 @foreach (var s in b.Servicios){ <tr><td>@s.Nombre</td><td class="text-center">@s.Cantidad</td><td class="text-end">@string.Format(usd, "{0:C}", Convert.ToDecimal(s.PrecioUnitario))</td><td class="text-end">@string.Format(usd, "{0:C}", Convert.ToDecimal(s.Subtotal))</td></tr> }
 </tbody>
 </table>
 }
 else { <p class="text-muted mb-0">Sin servicios.</p> }
 </div>
 </div>
 <div class="col-md-5">
 <div class="border rounded p-3 bg-light">
 <h6>Totales</h6>
 <div class="d-flex justify-content-between"><span>Subtotal habitación</span><strong>@string.Format(usd, "{0:C}", Convert.ToDecimal(b.SubtotalHabitacion))</strong></div>
 <div class="d-flex justify-content-between"><span>Total servicios</span><strong>@string.Format(usd, "{0:C}", Convert.ToDecimal(b.TotalServicios))</strong></div>
 <hr class="my-2" />
 <div class="d-flex justify-content-between fs-5"><span>Total</span><strong>@string.Format(usd, "{0:C}", Convert.ToDecimal(b.Total))</strong></div>
 @if(!hasReserva)
 {<small class="text-muted d-block mt-2">Valores de referencia guardados al registrar la habitación.</small>}
 </div>
 </div>
 </div>
 }
 <a class="btn btn-secondary mt-4" href="@Url.Action("Index")">Volver</a>
</div>
@section Scripts{
 <script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>
 <script>GLightbox({ selector: '.glightbox' });</script>
}