@using HotelSystem.Domain.Entities
@using X.PagedList.Mvc.Core
@model X.PagedList.IPagedList<Habitacion>
@{
 ViewData["Title"] = "Habitaciones";
 var tipoSel = Context?.Request?.Query["tipo"].ToString();
 var pisoSel = Context?.Request?.Query["piso"].ToString();
 var nombres = ViewBag.NombresPorHab as IDictionary<int,string> ?? new Dictionary<int,string>();
}
<div class="container mt-4">
 <h2>Habitaciones</h2>
 <div class="row mb-3">
 <div class="col-md-12">
 <form method="get" class="row g-2">
 <div class="col-sm-3">
 <select name="tipo" class="form-select">
 <option value="">Tipo (todos)</option>
 @foreach (var t in Enum.GetValues(typeof(TipoHabitacion)))
 {
 var val = ((int)t).ToString();
 <option value="@val" selected="@(tipoSel == val)">@t</option>
 }
 </select>
 </div>
 <div class="col-sm-3">
 <input class="form-control" type="number" name="piso" placeholder="Piso" value="@pisoSel" />
 </div>
 <div class="col-sm-6 text-end">
 <a class="btn btn-primary" href="@Url.Action("Create")">Nueva habitación</a>
 <button class="btn btn-secondary" type="submit">Filtrar</button>
 </div>
 </form>
 </div>
 </div>

 @if (TempData["Success"] != null)
 {
 <div class="alert alert-success">@TempData["Success"]</div>
 }
 @if (TempData["Error"] != null)
 {
 <div class="alert alert-danger">@TempData["Error"]</div>
 }

 <div class="mb-3 d-flex justify-content-end gap-2">
 <form asp-action="DeleteFirstTwoPages" method="post" onsubmit="return confirm('¿Eliminar todas las habitaciones de las dos primeras páginas? Esta acción también borra reservas relacionadas.');">
 <input type="hidden" name="tipo" value="@tipoSel" />
 <input type="hidden" name="piso" value="@pisoSel" />
 <button type="submit" class="btn btn-outline-danger btn-sm">Eliminar primeras2 páginas</button>
 </form>
 <form asp-controller="Admin" asp-action="WipeReservas" method="post" onsubmit="return confirm('¿Eliminar TODAS las reservas, sus detalles, servicios, facturas y transacciones?');">
 <button type="submit" class="btn btn-outline-warning btn-sm">Eliminar TODAS las reservas</button>
 </form>
 </div>

 <div class="table-responsive">
 <table class="table table-striped align-middle">
 <thead>
 <tr>
 <th>Nombre</th>
 <th>Número</th>
 <th>Piso</th>
 <th>Tipo</th>
 <th>Capacidad</th>
 <th>Amenidades</th>
 <th></th>
 </tr>
 </thead>
 <tbody>
 @foreach (var item in Model)
 {
 var nombre = (nombres.TryGetValue(item.Id, out var nom) && !string.IsNullOrWhiteSpace(nom)) ? nom : (item.RegistradoNombreCompleto ?? "");
 <tr>
 <td>@nombre</td>
 <td>@item.Numero</td>
 <td>@item.Piso</td>
 <td>@item.Tipo</td>
 <td>@item.Capacidad</td>
 <td>@item.Amenidades</td>
 <td class="text-end">
 <a class="btn btn-sm btn-outline-info" href="@Url.Action("Details", new { id = item.Id })">Detalles</a>
 <a class="btn btn-sm btn-outline-warning" href="@Url.Action("Edit", new { id = item.Id })">Editar</a>
 <a class="btn btn-sm btn-outline-danger" href="@Url.Action("Delete", new { id = item.Id })">Eliminar</a>
 </td>
 </tr>
 }
 </tbody>
 </table>
 </div>

 <div class="d-flex justify-content-center">
 @Html.PagedListPager(Model, page => Url.Action("Index", new { page, tipo = tipoSel, piso = pisoSel }))
 </div>
</div>