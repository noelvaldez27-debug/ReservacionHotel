@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@model ReserHotel.Models.ViewModels.ReservaSearchViewModel
@{
 ViewData["Title"] = "Buscar Disponibilidad";
 var filtros = Model.Filtros;
}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/%40eonasdan/tempus-dominus@6.9.7/dist/css/tempus-dominus.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css" />
<div class="container mt-4">
 <h2>Buscar Disponibilidad</h2>

 <form method="get" class="row g-3">
 <div class="col-md-3">
 <label class="form-label">Entrada</label>
 <div class="input-group" id="dtEntrada" data-td-target-input="nearest" data-td-target-toggle="nearest">
 <input class="form-control" id="fechaEntrada" name="FechaEntrada" type="text" value="@filtros.FechaEntrada?.ToString("yyyy-MM-dd")" data-td-target="#dtEntrada" />
 <span class="input-group-text" data-td-target="#dtEntrada" data-td-toggle="datetimepicker"><i class="bi bi-calendar"></i></span>
 </div>
 </div>
 <div class="col-md-3">
 <label class="form-label">Salida</label>
 <div class="input-group" id="dtSalida" data-td-target-input="nearest" data-td-target-toggle="nearest">
 <input class="form-control" id="fechaSalida" name="FechaSalida" type="text" value="@filtros.FechaSalida?.ToString("yyyy-MM-dd")" data-td-target="#dtSalida" />
 <span class="input-group-text" data-td-target="#dtSalida" data-td-toggle="datetimepicker"><i class="bi bi-calendar"></i></span>
 </div>
 </div>
 <div class="col-md-2">
 <label class="form-label">Huéspedes</label>
 <input class="form-control" name="CantidadHuespedes" type="number" min="1" value="@filtros.CantidadHuespedes" />
 </div>
 <div class="col-md-2">
 <label class="form-label">Precio máx.</label>
 <input class="form-control" name="PrecioMax" type="number" min="0" step="0.01" value="@filtros.PrecioMax" />
 </div>
 <div class="col-md-2">
 <label class="form-label">Hotel/Ubicación</label>
 <input class="form-control" name="Ubicacion" type="text" value="@filtros.Ubicacion" placeholder="Ciudad u hotel" />
 </div>
 <div class="col-md-4">
 <label class="form-label">Comodidades (coma)</label>
 <input class="form-control" name="Comodidades" type="text" value="@filtros.Comodidades" placeholder="wifi, desayuno" />
 </div>
 <div class="col-md-2 form-check align-self-end">
 <input class="form-check-input" type="checkbox" id="SoloJacuzzi" name="SoloJacuzzi" @(filtros.SoloJacuzzi ? "checked" : "") />
 <label class="form-check-label" for="SoloJacuzzi">Solo jacuzzi</label>
 </div>
 <div class="col-md-2 form-check align-self-end">
 <input class="form-check-input" type="checkbox" id="SoloWifi" name="SoloWifi" @(filtros.SoloWifi ? "checked" : "") />
 <label class="form-check-label" for="SoloWifi">Solo wifi</label>
 </div>
 <div class="col-12">
 <button class="btn btn-primary" type="submit">Buscar</button>
 </div>
 </form>

 @if (!ViewData.ModelState.IsValid)
 {
 <div class="alert alert-danger mt-3">
 @foreach (var err in ViewData.ModelState.Values.SelectMany(v => v.Errors))
 {
 <div>@err.ErrorMessage</div>
 }
 </div>
 }

 <hr />

 <div class="row">
 <div class="col-md-7">
 @if (Model.Resultados.Any())
 {
 <h4>Disponibles</h4>
 <div class="list-group">
 @foreach (var r in Model.Resultados)
 {
 <div class="list-group-item">
 <div class="row g-2">
 <div class="col-sm-3">
 <a href="@((r.Gallery.FirstOrDefault() ?? "/img/placeholder.png"))" class="glightbox" data-gallery="res">
 <img src="@((r.Gallery.FirstOrDefault() ?? "/img/placeholder.png"))" class="img-fluid rounded" />
 </a>
 </div>
 <div class="col-sm-9">
 <h5>@r.Hotel.Nombre - Habitación @r.Habitacion.Numero (@r.Habitacion.Tipo)</h5>
 <div>Amenidades incluidas: @string.Join(", ", r.AmenitiesIncluidas)</div>
 <div>Capacidad: @r.Habitacion.Capacidad</div>
 <div>Precio por noche (promedio): <strong>@r.PrecioPorNochePromedio.ToString("C")</strong></div>
 <div>Total @r.Noches noches: <strong>@r.PrecioTotal.ToString("C")</strong></div>
 <div class="mt-2">
 <strong>Servicios del hotel:</strong>
 <ul class="mb-1">
 @foreach (var s in r.ServiciosAdicionales)
 {
 <li>@s.Nombre - @s.Precio.ToString("C")</li>
 }
 </ul>
 </div>
 <div class="mt-2">
 <a class="btn btn-success"
 asp-controller="Reservas"
 asp-action="Create"
 asp-route-habitacionId="@r.Habitacion.Id"
 asp-route-fechaEntrada="@(Model.Filtros.FechaEntrada?.ToString("yyyy-MM-dd"))"
 asp-route-fechaSalida="@(Model.Filtros.FechaSalida?.ToString("yyyy-MM-dd"))">Reservar</a>
 </div>
 </div>
 </div>
 </div>
 }
 </div>
 }
 else
 {
 <div class="alert alert-info">No hay resultados.</div>
 }
 </div>
 </div>
 <div class="col-md-5">
 <h4>Ocupadas</h4>
 @if (Model.Ocupadas.Any())
 {
 <div class="list-group">
 @foreach (var o in Model.Ocupadas.OrderBy(x => x.DisponibleDesde))
 {
 <div class="list-group-item d-flex justify-content-between align-items-center">
 <div>
 <div><strong>@o.Hotel.Nombre</strong> - Habitación @o.Habitacion.Numero (@o.Habitacion.Tipo)</div>
 <div>Amenidades: @o.Habitacion.Amenidades</div>
 </div>
 <div>
 Disponible desde: <strong>@o.DisponibleDesde.ToString("yyyy-MM-dd")</strong>
 </div>
 </div>
 }
 </div>
 }
 else
 {
 <div class="alert alert-secondary">No hay habitaciones ocupadas en el rango consultado.</div>
 }
 </div>
 </div>
</div>

@section Scripts{
 <script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/%40eonasdan/tempus-dominus@6.9.7/dist/js/tempus-dominus.min.js"></script>
 <script>
 const pickerIn = new tempusDominus.TempusDominus(document.getElementById('dtEntrada'), { display: { components: { decades: false, year: true, month: true, date: true, hours: false, minutes: false } } });
 const pickerOut = new tempusDominus.TempusDominus(document.getElementById('dtSalida'), { display: { components: { decades: false, year: true, month: true, date: true, hours: false, minutes: false } } });
 GLightbox({ selector: '.glightbox' });
 </script>
}